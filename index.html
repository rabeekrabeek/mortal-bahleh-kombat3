<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mortal Bahleh Kombat 3 — Web Demo</title>
<style>
  html,body{margin:0;background:#000;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1024px;margin:0 auto;padding:12px}
  .card{background:#0b0b0c;border:1px solid #242428;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.4);overflow:hidden}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;background:#121214;border-bottom:1px solid #242428}
  .btn{background:#1f1f25;border:1px solid #2d2d36;border-radius:999px;padding:8px 14px;color:#fff;cursor:pointer}
  .btn:hover{background:#2a2a33}
  canvas{display:block;width:100%;height:auto}
  .help{color:#cfcfd6;font-size:14px;line-height:1.5}
  .kbd{padding:2px 6px;border:1px solid #2f2f36;background:#15151a;border-radius:6px;color:#d7d7de}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="topbar">
      <div><strong>Mortal Bahleh Kombat 3</strong> — Web Demo</div>
      <div>
        <button id="btnPause" class="btn">إيقاف مؤقت</button>
        <button id="btnReset" class="btn">بدء من جديد</button>
      </div>
    </div>
    <canvas id="game" width="960" height="540"></canvas>
  </div>
  <div class="help" style="padding:10px 4px">
    <div style="margin-bottom:6px"><strong>Player 1</strong>: حركة <span class="kbd">A</span>/<span class="kbd">D</span> • قفز <span class="kbd">W</span> • انحناء <span class="kbd">S</span> • صدّ <span class="kbd">R</span> • هجمات <span class="kbd">F</span>/<span class="kbd">G</span>/<span class="kbd">H</span></div>
    <div><strong>ملاحظة</strong>: هذا ديمو متصفح مستقل بملف واحد. الدم غزير جدًا، والخصم يتحرّك ويدافع أحيانًا. الإحساس مضبوط على وتيرة ألعاب سيجا.</div>
  </div>
</div>
<script>
// === Constants & core state
const W=960,H=540,GROUND=H-96,GRAV=0.8,FRIC=0.82;const ROUND_TIME=99;
const ST={BOOT:0,INTRO1:1,INTRO2:2,TITLE:3,SELECT:4,FIGHT:5};
let GAME={state:ST.BOOT,timer:0,round:1,roundTime:ROUND_TIME,message:"",shake:0, p1:null,p2:null, menuIndex:0, seed:Date.now()&0xffff};
function rand(){GAME.seed=(1664525*GAME.seed+1013904223)>>>0; return GAME.seed/0xffffffff;}// === Input const keys={}; window.addEventListener('keydown',e=>{keys[e.key]=true}); window.addEventListener('keyup',e=>{keys[e.key]=false});

// === Fighters function makeBoss(side){ return { side, x: side==='L'?W0.28:W0.72, y:GROUND, w:60, h:122, vx:0, vy:0, dir: side==='L'?1:-1, speed:6, jump:17, health:100, blocking:false, crouch:false, state:'idle', stun:0, atkCD:0 }; } const ATK={L:{r:55,d:6,hs:10,bs:7,p:6,su:4,ac:4,rc:8}, M:{r:70,d:10,hs:14,bs:9,p:8,su:6,ac:5,rc:12}, H:{r:92,d:15,hs:18,bs:12,p:12,su:8,ac:6,rc:18}}; function atkBox(f,a){const cx=f.x+f.dir*(f.w/2+a.r0.6);const cy=f.y-f.h0.62;const w=a.r,h=42;return {x:cx-w/2,y:cy-h/2,w,h};} function rects(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y}

// === Blood system const blood=[];function spawnBlood(x,y,amt=12,boost=1){for(let i=0;i<amt;i++){blood.push({x,y, vx:(rand()*2-1)6boost, vy:-Math.random()6boost-2, g:0.35, life:60+Math.random()*40, r:2+Math.random()*3});}} const stains=[];function addStain(x,y){stains.push({x,y,alpha:0.9});}

// === Audio (simple, synthetic — بدون ملفات خارجية) const AC=new (window.AudioContext||window.webkitAudioContext)(); function beep(freq=220,dur=0.06,vol=0.2,type='square'){const o=AC.createOscillator(),g=AC.createGain();o.type=type;o.frequency.value=freq;g.gain.value=vol;o.connect(g).connect(AC.destination);o.start();o.stop(AC.currentTime+dur);} function thud(){beep(90,0.07,0.25,'sawtooth');} function scream(){ // اندفاعة صوت "آه" قصيرة const o=AC.createOscillator();const g=AC.createGain();o.type='triangle';o.frequency.setValueAtTime(420,AC.currentTime);o.frequency.exponentialRampToValueAtTime(170,AC.currentTime+0.28);g.gain.setValueAtTime(0.0001,AC.currentTime);g.gain.exponentialRampToValueAtTime(0.6,AC.currentTime+0.02);g.gain.exponentialRampToValueAtTime(0.0001,AC.currentTime+0.45);o.connect(g).connect(AC.destination);o.start();o.stop(AC.currentTime+0.46); }

// === Flow helpers function boot(){GAME.state=ST.INTRO1;GAME.timer=120;} function toIntro2(){GAME.state=ST.INTRO2;GAME.timer=110;} function toTitle(){GAME.state=ST.TITLE;GAME.menuIndex=0;} function toSelect(){GAME.state=ST.SELECT;} function toFight(){ GAME.state=ST.FIGHT; GAME.roundTime=ROUND_TIME; blood.length=0; stains.length=0; GAME.p1=makeBoss('L'); GAME.p2=makeBoss('R');}

// === AI (dummy) function aiTick(f,enemy){ if(f.stun>0) return; const r=rand(); if(r<0.02) { f.vx += (enemy.x<f.x?-1:1) * (2+rand()2); } if(r>0.96){ if(f.vy===0) f.vy=-f.jump(0.6+rand()*0.2); } f.blocking = r>0.6 && r<0.68 && f.vy===0; if(f.atkCD<=0 && r>0.85 && Math.abs(enemy.x-f.x)<140) doAttack(f, r>0.93?'H':(r>0.9?'M':'L')); }

function doAttack(f,t){const A=ATK[t]; f.state='atk'; f.atkCD=A.su+A.ac+A.rc; f.vx+=f.dir*2;}

// === Update function update(dt){ const anyKey = Object.values(keys).some(Boolean); switch(GAME.state){ case ST.INTRO1: GAME.timer-=1; if(GAME.timer<=0||anyKey) toIntro2(); break; case ST.INTRO2: GAME.timer-=1; if(GAME.timer<=0||anyKey) toTitle(); break; case ST.TITLE: if(keys['Enter']||keys[' ']) { toSelect(); keys['Enter']=keys[' ']=false; } break; case ST.SELECT: if(keys['Enter']||keys[' ']) { toFight(); keys['Enter']=keys[' '']=false; } break; case ST.FIGHT: if(GAME.roundTime>0) GAME.roundTime -= dt/60; const f1=GAME.p1,f2=GAME.p2; const kL=keys['a'],kR=keys['d'],kU=keys['w'],kD=keys['s']; const kB=keys['r'],kF=keys['f'],kG=keys['g'],kH=keys['h']; f1.dir = f1.x<f2.x?1:-1; f2.dir = f2.x<f1.x?1:-1; f1.blocking = !!kB && f1.vy===0; f1.crouch = !!kD && f1.vy===0; if(f1.stun>0){ f1.stun-=1; } else { if(!f1.blocking && !f1.crouch && f1.state!=='atk'){ if(kL) f1.vx-=6; if(kR) f1.vx+=6; } if(kU && f1.vy===0 && !f1.blocking) f1.vy=-f1.jump; if(f1.atkCD>0) f1.atkCD-=1; else if(!f1.blocking){ if(kF) doAttack(f1,'L'); else if(kG) doAttack(f1,'M'); else if(kH) doAttack(f1,'H'); } } aiTick(f2,f1); if(f2.atkCD>0) f2.atkCD-=1; [f1,f2].forEach(f=>{ f.vx*=FRIC; f.vy+=GRAV; f.x+=f.vxdt/1.2; f.y+=f.vydt/1.2; if(f.y>GROUND){f.y=GROUND; f.vy=0;} f.x=Math.max(f.w/2,Math.min(W-f.w/2,f.x)); f.state=(f.vy!==0)?'jump':(Math.abs(f.vx)>0.6?'walk':(f.blocking?'block':(f.stun>0?'hit':(f.state==='atk'&&f.atkCD>0?'atk':'idle')))); }); handleHits(f1,f2); handleHits(f2,f1); for(let i=blood.length-1;i>=0;i--){const p=blood[i]; p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.life--; if(p.y>GROUND-2 && p.vy>0){ addStain(p.x,GROUND-4); p.life=0; } if(p.life<=0) blood.splice(i,1); } if(f1.health<=0 || f2.health<=0 || GAME.roundTime<=0){ GAME.state=ST.TITLE; } break; } }

function handleHits(A,B){ if(A.state!=='atk') return; const types=['H','M','L']; for(const t of types){ const a=ATK[t]; const cd=A.atkCD; const activeFrom=a.rc+a.ac; const activeTo=a.rc; if(cd<activeFrom && cd>=activeTo){ const hb=atkBox(A,a); const hurt={x:B.x-B.w/2,y:B.y-B.h,w:B.w,h:B.h}; if(rects(hb,hurt)){ const guarded=B.blocking && !B.crouch; const dmg=guarded?Math.ceil(a.d0.18):a.d; B.health=Math.max(0,B.health-dmg); B.stun=guarded?a.bs:a.hs; B.vx += A.dir * a.p * (guarded?0.5:1); if(!guarded) { B.vy -= 1.2; scream(); spawnBlood(B.x, B.y-B.h0.6, 22, t==='H'?1.8:1.2); thud(); } else { thud(); spawnBlood(B.x, B.y-B.h*0.6, 6, 0.6); } GAME.shake=5; break; } } }

// === Render const cvs=document.getElementById('game');const ctx=cvs.getContext('2d'); function draw(){ ctx.save(); ctx.clearRect(0,0,W,H); // stage ctx.fillStyle='#0b0b0c'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#15151a'; for(let i=0;i<8;i++){ ctx.fillRect(i*140-((Date.now()/60)%140), H-220, 100, 140); } ctx.fillStyle='#1f2937'; ctx.fillRect(0,GROUND+1,W,H-GROUND); ctx.strokeStyle='#34343c'; for(let x=0;x<W;x+=20){ ctx.beginPath(); ctx.moveTo(x,GROUND); ctx.lineTo(x,GROUND+12); ctx.stroke(); }

// flow screens if(GAME.state===ST.INTRO1){ drawIntro1(); ctx.restore(); return; } if(GAME.state===ST.INTRO2){ drawIntro2(); ctx.restore(); return; } if(GAME.state===ST.TITLE){ drawTitle(); ctx.restore(); return; } if(GAME.state===ST.SELECT){ drawSelect(); ctx.restore(); return; }

drawHUD(); stains.forEach(s=>{ ctx.globalAlpha=s.alpha; ctx.fillStyle='#6b0000'; ctx.beginPath(); ctx.ellipse(s.x,GROUND-3,8,3,0,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1; }); blood.forEach(p=>{ ctx.fillStyle='#a30000'; ctx.fillRect(p.x, p.y, p.r, p.r); }); drawBoss(GAME.p1,'L'); drawBoss(GAME.p2,'R'); ctx.restore(); }

function drawHUD(){ const {p1,p2}=GAME; ctx.save(); ctx.fillStyle='#111'; ctx.fillRect(0,0,W,64); const barW=W*0.4, barH=18, pad=14; // P1 ctx.fillStyle='#333'; ctx.fillRect(pad,18,barW,barH); ctx.fillStyle='#e11d48'; ctx.fillRect(pad,18,(p1.health/100)*barW,barH); ctx.fillStyle='#333'; ctx.fillRect(W-pad-barW,18,barW,barH); ctx.fillStyle='#0ea5e9'; ctx.fillRect(W-pad-(p2.health/100)*barW,18,(p2.health/100)*barW,barH); ctx.fillStyle='#ffd700'; ctx.font='bold 30px ui-sans-serif'; ctx.textAlign='center'; ctx.fillText(String(Math.max(0,Math.ceil(GAME.roundTime))), W/2, 40); ctx.restore(); }

function drawBoss(f,side){ ctx.save(); const sx=(Math.random()-0.5)*GAME.shake, sy=(Math.random()-0.5)GAME.shake; GAME.shake=Math.max(0,GAME.shake-0.4); ctx.translate(sx,sy); ctx.fillStyle= side==='L'? '#e11d48':'#0ea5e9'; ctx.fillRect(f.x-f.w/2, f.y-f.h, f.w, f.h); // بديل مؤقت للسبرايت ctx.fillStyle='#ffffff'; for(let i=0;i<6;i++){ ctx.fillRect(f.x-14+i5, f.y-f.h-14-Math.random()*6, 4, 14); } // شعر أبيض ctx.fillStyle='#000'; ctx.fillRect(f.x-10, f.y-f.h+34, 20, 2); // خط وجه بسيط ctx.restore(); }

function drawIntro1(){ ctx.save(); ctx.fillStyle='#0a1a4a'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#fff'; ctx.font='bold 80px ui-sans-serif'; ctx.textAlign='center'; ctx.fillText('SEYGA!', W/2, H/2); ctx.font='16px ui-sans-serif'; ctx.fillText('شارة شبيهة — ليست أصلية', W/2, H/2+42); ctx.restore(); } function drawIntro2(){ ctx.save(); ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#0ff'; ctx.font='bold 42px ui-sans-serif'; ctx.textAlign='center'; ctx.fillText('ChatGPT Presents', W/2, H/2-12); ctx.fillStyle='#fff'; ctx.font='28px ui-sans-serif'; ctx.fillText('برعاية ربيع', W/2, H/2+26); ctx.restore(); } function drawTitle(){ ctx.save(); const g=ctx.createRadialGradient(W/2,H/2,40,W/2,H/2,420); g.addColorStop(0,'#3a0a0a'); g.addColorStop(1,'#130303'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H); ctx.fillStyle='#d9d5c7'; ctx.textAlign='center'; ctx.font='bold 64px ui-sans-serif'; ctx.fillText('MORTAL BAHLEH KOMBAT 3', W/2, H0.35); ctx.font='24px ui-sans-serif'; const opts=['START','2 PLAYER (قريبًا)','OPTIONS']; for(let i=0;i<opts.length;i++){ ctx.fillStyle=i===GAME.menuIndex?'#ffd700':'#eae9e2'; ctx.fillText(opts[i], W/2, H0.52+i34); } if(keys['ArrowUp']){GAME.menuIndex=Math.max(0,GAME.menuIndex-1); keys['ArrowUp']=false} if(keys['ArrowDown']){GAME.menuIndex=Math.min(2,GAME.menuIndex+1); keys['ArrowDown']=false} if(keys['Enter']||keys[' ']){ if(GAME.menuIndex===0) toSelect(); keys['Enter']=keys[' ']=false; } ctx.restore(); } function drawSelect(){ ctx.save(); ctx.fillStyle='#120707'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#ddd'; ctx.textAlign='center'; ctx.font='bold 36px ui-sans-serif'; ctx.fillText('اختيار الشخصية', W/2, 70); const cols=4, rows=3, cw=180, ch=110, ox=(W-(colscw))/2, oy=120; let idx=0; for(let r=0;r<rows;r++){ for(let c=0;c<cols;c++){ const x=ox+ccw, y=oy+rch; ctx.strokeStyle='#333'; ctx.strokeRect(x,y,cw-14,ch-14); if(idx===0){ ctx.fillStyle='#e11d48'; ctx.fillRect(x+8,y+8,cw-30,ch-30); ctx.fillStyle='#fff'; ctx.fillText('الزعيم', x+cw/2-8, y+ch/2); } else { ctx.fillStyle='#555'; ctx.fillRect(x+8,y+8,cw-30,ch-30); ctx.fillStyle='#aaa'; ctx.fillText('LOCKED', x+cw/2-8, y+ch/2); } idx++; } } ctx.fillStyle='#ffd700'; ctx.font='22px ui-sans-serif'; ctx.fillText('اضغط Enter للبدء', W/2, H-34); if(keys['Enter']||keys[' ']){ toFight(); keys['Enter']=keys[' ']=false; } ctx.restore(); }

// === Loop & controls let last=performance.now(); let paused=false; const btnPause=document.getElementById('btnPause'); const btnReset=document.getElementById('btnReset'); btnPause.onclick=()=>{paused=!paused; btnPause.textContent=paused?'استئناف':'إيقاف مؤقت'}; btnReset.onclick=()=>{toTitle()}; function loop(now){ const dt=Math.min(33,now-last); last=now; if(!paused){ update(dt); draw(); } requestAnimationFrame(loop); } boot(); requestAnimationFrame(loop); </script>

</body>
</html>
